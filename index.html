<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>åƒä»€éº¼å¹«æˆ‘é¸ï¼</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Noto Sans TC', sans-serif;
      display: flex;
      background-color: #fffaf2;
    }
    aside {
      width: 200px;
      background-color: #fff0d6;
      height: 100vh;
      padding: 20px;
      box-shadow: 2px 0 8px rgba(0,0,0,0.1);
    }
    aside h2 {
      font-size: 20px;
      margin-bottom: 30px;
      color: #d9480f;
    }
    aside button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      background-color: #ffa94d;
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    main {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }
    #bear {
      height: 300px;
      margin-right: 20px;
    }
    #wheel-canvas {
      margin: 20px auto;
      display: block;
      border: 6px solid #ffa94d;
      border-radius: 50%;
    }
    #recommendations, #home-recommend {
      display: flex;
      overflow-x: auto;
      gap: 20px;
      padding: 10px 0;
    }
    .card {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 15px;
      width: 260px;
      flex: 0 0 auto;
      text-align: left;
    }
    .card h3 { color: #d9480f; margin-bottom: 5px; }
    .card p { margin: 4px 0; color: #333; font-size: 15px; }
    .card button {
      background-color: #ff9f43;
      border: none;
      color: white;
      padding: 5px 10px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }
    #map {
      height: 400px;
      margin-top: 20px;
      border-radius: 12px;
    }
    select, input[type=range], input[type=text] {
      padding: 8px;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 100%;
    }
  </style>
</head>
<body>
    <aside>
      <h2>ğŸ½ åŠŸèƒ½é¸å–®</h2>
      <button onclick="showPage('home')">ğŸ  é¦–é </button>
      <button onclick="showPage('spin')">ğŸ¡ ä»Šå¤©è¦åƒä»€éº¼</button>
      <button onclick="showPage('add')">â• æ–°å¢ç¾é£Ÿå¡ç‰‡</button>
    </aside>
  
    <main>
      <!-- ä¸»é å…§å®¹ -->
      <div id="home" style="display:block">
        <h1>ğŸ± å€‹äººåŒ–ç¾é£Ÿæ¨è–¦</h1>
        <input type="text" id="searchInput" placeholder="ğŸ” æœå°‹åº—åæˆ–é¡å‹...">
        
        <label>æˆ‘æ˜¯...</label>
        <select id="user-type">
          <option value="student">å­¸ç”Ÿ</option>
          <option value="office">å°è³‡æ—</option>
          <option value="fitness">å¥èº«æ—</option>
        </select>
  
        <label>æ‰€åœ¨åŸå¸‚</label>
        <select id="city">
          <option value="èŠ±è“®">èŠ±è“®</option>
          <option value="å°åŒ—">å°åŒ—</option>
          <option value="æ¡ƒåœ’">æ¡ƒåœ’</option>
          <option value="å°å—">å°å—</option>
          <option value="å®œè˜­">å®œè˜­</option>
        </select>
  
        <label>é ç®—ä¸Šé™</label>
        <input type="range" id="price-range" min="50" max="400" value="200" step="10">
        <div id="price-display">200 å…ƒ</div>
  
        <label>åå¥½ç¾é£Ÿé¡åˆ¥</label>
        <select id="food-type">
          <option value="">è«‹é¸æ“‡</option>
          <option value="ğŸœ æ‹‰éºµ">ğŸœ æ‹‰éºµ</option>
          <option value="ğŸ° ç”œé»">ğŸ° ç”œé»</option>
          <option value="ğŸš ä¸­å¼å°åƒ">ğŸš ä¸­å¼å°åƒ</option>
          <option value="ğŸ± æ—¥å¼å°åƒ">ğŸ± æ—¥å¼å°åƒ</option>
          <option value="ğŸ› å’–å“©">ğŸ› å’–å“©</option>
          <option value="ğŸ¥— è¼•é£Ÿ">ğŸ¥— è¼•é£Ÿ</option>
          <option value="ğŸ• ç•°åœ‹æ–™ç†">ğŸ• ç•°åœ‹æ–™ç†</option>
          <option value="ğŸ¥¦ å¥åº·é¤">ğŸ¥¦ å¥åº·é¤</option>
        </select>
  
        <button onclick="manualRecommend()">æ¨è–¦ç¾é£Ÿ</button>
        <div id="home-recommend"></div>
        <div id="map"></div>
      </div>
  
      <!-- è½‰ç›¤é é¢ -->
      <div id="spin" style="display:none">
        <h1>ğŸ´ ä»Šå¤©åƒä»€éº¼ï¼Ÿè®“ç¾é£Ÿè½‰ç›¤å¹«ä½ æ±ºå®šï¼</h1>
        <div style="display: flex; align-items: center; justify-content: center;">
          <img src="quokka.png" alt="å¯æ„›ç†Š" id="bear">
          <canvas id="wheel-canvas" width="300" height="300"></canvas>
        </div>
        <button onclick="spinWheel()">è½‰ä¸€ä¸‹ ğŸ¡</button>
        <p id="spin-result"></p>
        <div id="recommendations"></div>
      </div>
  
      <!-- æ–°å¢å¡ç‰‡é é¢ -->
      <div id="add" style="display:none">
        <h2>â• æ–°å¢ä½ çš„ç§è—ç¾é£Ÿ</h2>
        <section id="add-form-section">
          <input type="text" id="add-name" placeholder="åº—å">
          <input type="text" id="add-type" placeholder="é¡å‹">
          <input type="text" id="add-city" placeholder="åŸå¸‚">
          <input type="text" id="add-address" placeholder="åœ°å€">
          <input type="text" id="add-price" placeholder="åƒ¹æ ¼">
          <input type="text" id="add-rating" placeholder="è©•åˆ†">
          <textarea id="add-note" placeholder="æ¨è–¦èª"></textarea>
          <button onclick="addCard()">æ–°å¢ç¾é£Ÿæ¨è–¦</button>
        </section>
        <section id="user-added"></section>
      </div>
    </main>
    <audio id="bg-music" src="happy-music.mp3"></audio>
    <script src="recommendations.js"></script>
    <script>
      const map = L.map('map').setView([23.9911, 121.6027], 13);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
      }).addTo(map);
  
      const pages = {
        home: document.getElementById("home"),
        spin: document.getElementById("spin"),
        add: document.getElementById("add")
      };
      const music = document.getElementById("bg-music");
  
      function showPage(id) {
        Object.keys(pages).forEach(key => pages[key].style.display = "none");
        pages[id].style.display = "block";
        if (id === 'spin') music.play();
        else music.pause();
      }
  
      document.getElementById("price-range").addEventListener("input", () => {
        document.getElementById("price-display").textContent = `${document.getElementById("price-range").value} å…ƒ`;
      });
  
      function createCard(item) {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h3>${item.name}</h3>
          <p>é¡å‹ï¼š${item.type}</p>
          <p>åƒ¹æ ¼ï¼š${item.price}</p>
          <p>è©•åˆ†ï¼š${item.rating}</p>
          <p>æ¨è–¦èªï¼š${item.note}</p>
        `;
        const btn = document.createElement("button");
        btn.textContent = "ğŸ’– æ”¶è—";
        btn.onclick = () => {
          if (item.lat && item.lon) {
            L.marker([item.lat, item.lon]).addTo(map).bindPopup(item.name);
            alert(`${item.name} å·²åŠ å…¥åœ°åœ–æ”¶è—ï¼`);
          } else {
            alert("æœ¬é …ç›®ç„¡åº§æ¨™è³‡æ–™ï¼Œç„¡æ³•åŠ å…¥åœ°åœ–ã€‚");
          }
        };
        card.appendChild(btn);
        return card;
      }
  
      function manualRecommend() {
        const type = document.getElementById("food-type").value;
        const city = document.getElementById("city").value;
        const price = parseInt(document.getElementById("price-range").value);
        const resultArea = document.getElementById("home-recommend");
        resultArea.innerHTML = "";
  
        if (recommendationsData[type]) {
          const matched = recommendationsData[type].filter(item => parseInt(item.price) <= price && (!item.city || item.city === city));
          if (matched.length === 0) {
            resultArea.innerHTML = "<p>è©²æœå°‹é …ç›®ç„¡ç¬¦åˆæ¢ä»¶</p>";
          } else {
            matched.forEach(item => resultArea.appendChild(createCard(item)));
          }
        }
      }
  
      document.getElementById("searchInput").addEventListener("input", function () {
        const keyword = this.value.toLowerCase();
        document.querySelectorAll(".card").forEach(card => {
          const text = card.innerText.toLowerCase();
          card.style.display = text.includes(keyword) ? "block" : "none";
        });
      });
  
      // è½‰ç›¤é‚è¼¯
      const options = ["ğŸœ æ‹‰éºµ", "ğŸ° ç”œé»", "ğŸš ä¸­å¼å°åƒ", "ğŸ± æ—¥å¼å°åƒ", "ğŸ› å’–å“©", "ğŸ¥— è¼•é£Ÿ", "ğŸ• ç•°åœ‹æ–™ç†", "ğŸ¥¦ å¥åº·é¤"];
      const canvas = document.getElementById("wheel-canvas");
      const ctx = canvas.getContext("2d");
      const arc = Math.PI * 2 / options.length;
  
      function drawWheel() {
        for (let i = 0; i < options.length; i++) {
          const angle = i * arc;
          ctx.beginPath();
          ctx.fillStyle = i % 2 === 0 ? "#ffd580" : "#ffe0b3";
          ctx.moveTo(150, 150);
          ctx.arc(150, 150, 150, angle, angle + arc);
          ctx.fill();
          ctx.save();
          ctx.translate(150, 150);
          ctx.rotate(angle + arc / 2);
          ctx.textAlign = "center";
          ctx.fillStyle = "#333";
          ctx.font = "16px sans-serif";
          ctx.fillText(options[i], 80, 6);
          ctx.restore();
        }
      }
      drawWheel();
  
      function spinWheel() {
        const rotation = 360 * 5 + Math.floor(Math.random() * 360);
        canvas.style.transition = "transform 4s ease-out";
        canvas.style.transform = `rotate(${rotation}deg)`;
  
        const index = Math.floor(((360 - (rotation % 360)) % 360) / (360 / options.length));
        const selected = options[index];
  
        setTimeout(() => {
          document.getElementById("spin-result").innerText = `ä½ ä»Šå¤©å¯ä»¥è©¦è©¦çœ‹ï¼š${selected}`;
          showRecommendations(selected);
        }, 4000);
      }
  
      function showRecommendations(type) {
        const resultArea = document.getElementById("recommendations");
        resultArea.innerHTML = "";
        if (recommendationsData[type]) {
          recommendationsData[type].slice(0, 5).forEach(item => {
            resultArea.appendChild(createCard(item));
          });
        }
      }
  
      function addCard() {
        // ç°¡åŒ–ç¤ºç¯„ï¼šå¯¦éš›é–‹ç™¼å¯ä¸²æ¥åœ°å€è½‰ç¶“ç·¯åº¦ API
        const name = document.getElementById("add-name").value;
        const type = document.getElementById("add-type").value;
        const city = document.getElementById("add-city").value;
        const address = document.getElementById("add-address").value;
        const price = document.getElementById("add-price").value;
        const rating = document.getElementById("add-rating").value;
        const note = document.getElementById("add-note").value;
  
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h3>${name}</h3>
          <p>é¡å‹ï¼š${type}</p>
          <p>åƒ¹æ ¼ï¼š${price}</p>
          <p>è©•åˆ†ï¼š${rating}</p>
          <p>åŸå¸‚ï¼š${city}</p>
          <p>åœ°å€ï¼š${address}</p>
          <p>æ¨è–¦èªï¼š${note}</p>
        `;
        document.getElementById("user-added").appendChild(card);
      }
    </script>
  </body>
  </html>
    